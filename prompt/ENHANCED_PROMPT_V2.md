# プロジェクト名: smart-img-compress-cli

## プロジェクト概要
画像フォルダを対象に、**オプション指定不要の自動最適化**でCLIから一括で画像圧縮・リサイズ・形式変換を行うNode.js製のインテリジェントツール。

## 核心価値提案
**「97%削減という具体的価値を、設定不要で誰でも得られる」**
- ユーザーは複雑なオプションを覚える必要なし
- 自動的に最適な圧縮レベルを選択・適用
- 専門知識不要で高品質な結果を実現

---

## 使用技術スタック

### 🎯 **推奨技術（実績ベース）**
```javascript
// 画像処理・パフォーマンス
- Node.js 18+ + TypeScript
- sharp（高性能画像処理、libvipsベース）

// CLI・ユーザビリティ
- commander（CLIオプション解析）
- chalk v4.x（ログ装飾、ESM互換性考慮）
- cli-progress（視覚的プログレスバー）

// 品質保証・開発効率
- jest + ts-jest（ユニットテスト、ESM設定注意）
- eslint + prettier（静的解析・整形）
- Docker（実行・配布用）
```

### ⚠️ **重要な技術選択の注意点**
```markdown
- chalk: v4.x推奨（v5はESMでJest競合の可能性）
- jest: CommonJS互換性を考慮した設定が必要
- パッケージ脆弱性チェックを継続実施（npm audit）
```

---

## 🎨 **核心機能: スマート自動最適化**

### インテリジェントPNG圧縮
```typescript
// 3段階自動圧縮ロジック
1. 標準圧縮 → 結果を評価
2. 改善が少ない場合（80%以上サイズ）→ 積極的圧縮
3. さらに必要な場合（60%以上サイズ）→ 超強力圧縮
4. 最小サイズの結果を自動選択

// 透明度・アルファチャンネル保持
// ファイル特性に応じた最適パラメータ自動調整
```

### CLI使用方法（UX重視）
```bash
# 基本使用（オプション不要の自動最適化）
smart-img-compress ./images

# 出力先指定のみ
smart-img-compress ./images --output ./compressed

# 高度なカスタマイズ（必要時のみ）
smart-img-compress ./images \
  --format webp \
  --quality 85 \
  --resize 1920x1080
```

---

## 🚀 **機能要件（優先順位付き）**

### 🎯 **Priority 1: 自動最適化機能**
- ✅ スマートPNG圧縮（3段階自動選択）
- ✅ 透明度・品質の自動バランス調整
- ✅ ファイル特性に応じた最適化
- ✅ オプション不要での高品質結果

### 📊 **Priority 2: 基本機能**
- ✅ 指定フォルダ内の画像を再帰的に検索し一括処理
- ✅ JPEG / PNG / WebP / TIFF / BMP対応
- ✅ リサイズ・圧縮・形式変換
- ✅ 視覚的プログレスバー（大量処理対応）
- ✅ 詳細な処理統計表示（削減率・処理時間）

### ⚙️ **Priority 3: 拡張機能**
- ✅ 設定ファイル対応（.smart-img-compress.config.js/json）
- ✅ 自動提案機能（より良い圧縮方法の提案）
- ✅ 小さなファイルの自動スキップ
- ✅ グレースフル復旧（一部失敗しても処理継続）

### 🛡️ **Priority 4: 品質・運用**
- ✅ 包括的エラーハンドリング（カスタム例外クラス）
- ✅ Jest単体テスト（100%通過目標）
- ✅ ESLint/Prettier（エラー0件目標）
- ✅ Docker対応・セキュリティ設計（非rootユーザー）

---

## 📁 **推奨ディレクトリ構成**

```
smart-img-compress-cli/
├── bin/
│   └── index.ts              # CLIエントリーポイント
├── src/
│   ├── compress.ts           # 🎨 スマート圧縮ロジック（核心機能）
│   ├── utils.ts              # 共通関数・ファイル操作
│   ├── config.ts             # 設定ファイル管理
│   └── errors.ts             # カスタム例外クラス
├── tests/
│   ├── compress.test.ts      # 圧縮機能テスト
│   ├── utils.test.ts         # ユーティリティテスト
│   └── config.test.ts        # 設定管理テスト
├── docs/
│   ├── README.md             # ユーザー向けドキュメント
│   └── API.md                # 開発者向けAPI仕様
├── .github/
│   └── workflows/
│       └── ci.yml            # CI/CDパイプライン
├── Dockerfile                # コンテナ対応
├── package.json
├── tsconfig.json
├── jest.config.js            # テスト設定（ESM互換性考慮）
├── .eslintrc.json
├── .prettierrc
└── .smart-img-compress.config.js  # デフォルト設定例
```

---

## 🎯 **段階的開発計画（実装順序）**

### Phase 1: 基盤構築 🏗️
```bash
1. プロジェクト初期化・TypeScript設定
2. bin/index.ts にCLIエントリーポイント（commander）
3. 基本的なファイル検索・出力機能
4. ログ出力装飾（chalk + cli-progress）
```

### Phase 2: 核心機能実装 🎨
```bash
5. src/compress.ts にスマート圧縮ロジック実装
   - 3段階圧縮判定アルゴリズム
   - Sharp最適化パラメータ
6. 透明度・アルファチャンネル保持機能
7. ファイル特性に応じた自動最適化
```

### Phase 3: UX向上 ✨
```bash
8. 自動提案機能（より良い圧縮方法）
9. 設定ファイル対応（JS/JSON）
10. エラーハンドリング強化（カスタム例外）
11. 小さなファイルスキップ・グレースフル復旧
```

### Phase 4: 品質保証 🛡️
```bash
12. Jest単体テスト（モック・非同期・エラーケース）
13. ESLint/Prettier設定・全エラー解消
14. パッケージ脆弱性チェック・セキュリティ対応
15. Docker化・非rootユーザー設定
```

### Phase 5: 運用準備 🚀
```bash
16. CI/CDパイプライン構築（GitHub Actions）
17. README/ドキュメント整備（実用例中心）
18. パフォーマンステスト・最適化
19. リリース準備・バージョン管理
```

---

## 💡 **重要な設計指針**

### 🎯 **ユーザビリティファースト**
```markdown
- オプション暗記不要の自動最適化
- 直感的な操作性（smart-img-compress ./folder）
- 自動提案による学習支援
- エラー時の分かりやすいガイダンス
```

### 🔧 **技術的堅実性**
```markdown
- パッケージ互換性事前考慮（ESM/CommonJS）
- 段階的圧縮アルゴリズムの閾値調整
- メモリ効率・大容量ファイル対応
- 拡張性を考慮したモジュール設計
```

### 🛡️ **品質保証の徹底**
```markdown
- テスト駆動開発（TDD）アプローチ
- 継続的品質改善プロセス
- セキュリティベストプラクティス
- 実装変更に強いテスト設計
```

---

## 📊 **成功指標・目標**

### 🎯 **機能的目標**
- **圧縮効果**: PNG→JPEG で90%以上削減
- **自動最適化**: オプション無しで60%以上削減
- **処理性能**: 1000枚/分以上の処理速度
- **ユーザビリティ**: 3ステップ以内での基本操作完了

### 🛡️ **品質目標**
- **テスト通過率**: 100%（13個以上のテスト）
- **セキュリティ**: 脆弱性0件維持
- **コード品質**: Lintエラー0件
- **ドキュメント**: README理解度90%以上

---

## ⚠️ **注意事項・リスク対策**

### 🔧 **技術的リスク**
```markdown
1. ESM/CommonJS互換性問題
   → パッケージバージョン慎重選択・Jest設定調整

2. Sharp依存関係の複雑さ
   → Docker環境での事前検証・libvips対応確認

3. 大容量ファイル処理
   → ストリーミング処理・メモリ使用量監視
```

### 📊 **ユーザビリティリスク**
```markdown
1. 自動最適化の判定精度
   → 多様なファイルでのテスト・閾値調整

2. 処理時間の長さ
   → プログレスバー・キャンセル機能・並列処理

3. 設定の複雑化
   → シンプルなデフォルト・段階的カスタマイズ
```

---

## 🚀 **将来拡張計画**

### 短期（v1.x）
- AVIF形式サポート
- 並列処理オプション
- インタラクティブモード

### 中期（v2.x）
- ワーカースレッド活用
- プラグインアーキテクチャ
- Web UI版

### 長期（v3.x）
- AI による画質予測
- クラウド連携
- バッチ処理API

---

## 🎊 **まとめ：成功の方程式**

```markdown
優秀なプロンプト（技術基盤） + 創造的実装（革新機能） = 期待を超える成果

このプロンプトは以下を提供します：
✅ 実証済み技術スタックによる堅実な基盤
✅ ユーザビリティファーストの設計思想
✅ 段階的開発による確実な価値創出
✅ 品質保証・セキュリティ・拡張性への配慮
```

**目指すゴール**: 「オプション不要で97%削減」という革新的価値を持つ、誰でも使える画像圧縮ツールの実現

---

*Generated on 2025年8月1日 - v2.0 Enhanced Project Prompt*
